*NLZ: Program to create and clean the 1929 MS data, 11/9/10*Preliminariesclearcapture log closeset more offcd "/Users/nicolaslehmannziebarth/Dropbox/Depression Census/Datasets/Mississippi"log using missippi_dataset_1929.txt, text replaceclearset mem 200minsheet using MS_1929.csvreplace state="Mississippi" if state=="Cleveland Miss" | state=="Mississippi." | state==""drop if state~="Mississippi"label define yesno 0 "No" 1 "Yes"//can probably clean up these few variables a bit more, but not really that importantrename changedlocation change_locationreplace change_location = "1" if change_location == "Yes" | change_location == "420 Broadway"replace change_location = "0" if change_location == "No" | change_location == "None"destring change_location, replace forcelabel values change_location yesnolabel var change_location "Changed location?"rename changedname change_namereplace change_name = "1" if change_name == "Yes" | change_name == "Chinese Noodle Mfg Company" | change_name == "Oakland Noodle Factory"replace change_name = "0" if change_name == "No" | change_name == "None"destring change_name, replace forcelabel values change_name yesnolabel var change_name "Changed name?"rename changedownership change_ownershipreplace change_ownership = "1" if substr(change_ownership,1,4) == "Indi" | change_ownership == "V. Iuliano" | change_ownership == "YES" | change_ownership == "Yes"replace change_ownership = "1" if change_ownership == "Yes from Sosso to Sosso Jr" | change_ownership == "Yes from U.S. Macaroni Co." | change_ownership == "Yes, from Figler Saltzman and Co."replace change_ownership = "0" if change_ownership == "No" | change_ownership == "No Changes" | change_ownership == "no"destring change_ownership, replace forcelabel values change_ownership yesnoreplace isthisincorporated="1" if regexm(isthisincorporated,"Yes") | regexm(isthisincorporated,"Partnership") | regexm(isthisincorporated,"Incorporated") replace isthisincorporated="0" if regexm(isthisincorporated,"No") | regexm(isthisincorporated,"Owner") | regexm(isthisincorporated,"Not Incoporated")  destring isthisincorporated, replace forcelabel values isthisincorporated yesnorename branchofsubidiary branchofsubsidiaryreplace branchofsubsidiary="1" if regexm(branchofsubsidiary,"Yes") replace branchofsubsidiary="0" if branchofsubsidiary~="1"replace branchofsubsidiary="" if isthisincorporated==.destring branchofsubsidiary, replace forcelabel values branchofsubsidiary yesnorename branchofsubsidiary subsidiaryofanotherreplace began = "October 1, 1929" if began=="October, 1929"replace began = "September 1, 1928" if began=="September, 1928"replace began = "May 1, 1929" if began=="May, 1929"replace began = "August 1, 1929" if began=="August, 1929"replace began = "January 1, 1929" if began=="January, 1929"replace began = "January 1, 1930" if began=="January, 1930"replace began = "November 1, 1928" if began=="November, 1928"replace end = "September 30, 1929" if end=="September, 1929"replace end = "November 30, 1929" if end=="November, 1929"replace end = "March 1, 1930" if end=="March, 1930"replace end = "January 1, 1930" if end=="January, 1930"replace end = "December 31, 1930" if end=="December, 1930"replace end = "December 31, 1929" if end=="December, 1929"replace end = "January 1, 1930" if end=="January 1," & began=="January 1, 1929"replace end = "December 31, 1929" if end=="December" & began=="January 1, 1929"replace numdaysplantinoperation = "118.5" if numdaysplantinoperation=="118.5 (24 Hours Days)"destring numdaysplantinoperation, force replace ignore("(Approximate)")replace numdaysplantinoperation = . if numdaysplantinoperation>365destring hoursperday, force replace ignore("Hrs")replace hoursperweek = "14.5" if regexm(hoursperweek,"14 1/2")destring hoursperweek, force replace ignore(" Hours")drop doesthis*rename normalnumberofhoursperweekfo hours_per_wage_earnerdestring hours_per_wage_earner, force replacerename male proprietors_malelabel var proprietors_male "Number of male proprietors"rename female proprietors_femalelabel var proprietors_female "Number of female proprietors"rename v27 officers_malelabel var officers_male "Number of principal officers male"rename v28 officers_female label var officers_female "Number of principal officers female"rename v29 managers_malelabel var managers_male "Number of managers male"rename v30 managers_femalelabel var managers_female "Number of managers female"foreach i in "jan" "feb" "march" "april" "may" "june" "july" "august" "september" "october" "november" "december" "total"{tostring `i', replace forcereplace `i' = "0" if `i'=="None"destring `i', replace forcerename `i' wage_earners_`i'label var wage_earners_`i' "Number of wage earners"}replace asalariestoprincipalofficiers="0" if asalariestoprincipalofficiers=="None"destring asalariestoprincipalofficiers, replace forcerename asalariestoprincipalofficiers salaries_officerslabel var salaries_officers "Salaries for principal officers"destring bsalariestomanagers, replace forcerename bsalariestomanagers salaries_managerslabel var salaries_managers "Salaries for managers"replace cpaidtowageearners="0" if cpaidtowageearners=="None"destring cpaidtowageearners, replace forcerename cpaidtowageearners total_wageslabel var total_wages "Total Wage Bill"rename v47 total_wages_salarieslabel var total_wages_salaries "Total wages and salaries"//have no idea what's going on with usedorpurchased variablereplace costofallmaterials="0" if costofallmaterials=="None"destring costofallmaterials, replace forcelabel var costofallmaterials "Cost of all materials"//need to check if these are correct namesrename v50 cost_materials_1label var cost_materials_1 "Cost Materials 1"rename v51 cost_materials_2label var cost_materials_2 "Cost Materials 2"rename v52 cost_materials_3label var cost_materials_3 "Cost Materials 3"rename v53 cost_materials_4label var cost_materials_4 "Cost Materials 4"replace costoffuel="0" if costoffuel=="None" | costoffuel=="0"destring costoffuel, replace forcerename costoffuel cost_fuellabel var cost_fuel "Cost of fuel"rename costofcontractwork cost_contract_worklabel var cost_contract_work "Cost of contract work"replace cost_materials_1 = 0 if cost_materials_1==.replace cost_materials_2 = 0 if cost_materials_2==.replace cost_materials_3 = 0 if cost_materials_3==.replace cost_materials_4 = 0 if cost_materials_4==.replace cost_materials_1 = cost_materials_1 + cost_materials_2 + cost_materials_3 + cost_materials_4rename cost_materials_1 total_cost_materialslabel variable total_cost_materials "Total cost of materials"replace total_cost = total_cost_materials + total_wages if industrycode==311rename totalvalue total_costlabel var total_cost "Total Cost (materials and labor)"//still probably need to do some work on classifying output goods and input goodsdestring quantity, replace force ignore("Mftcases")rename quantity output_quantity_1label var output_quantity_1 "Quantity of output 1"rename units output_unit_1label var output_unit_1 "Unit of output 1"rename value output_value_1label var output_value_1 "Value of output 1"rename v61 output_specify_1label var output_specify_1 "Type of output 1"destring v62, replace force ignore("Mftcases")rename v62 output_quantity_2label var output_quantity_2 "Quantity of output 2"rename v64 output_unit_2label var output_unit_2 "Unit of output 2"rename v63 output_value_2label var output_value_2 "Value of output 2"rename v65 output_specify_2label var output_specify_2 "Type of output 2"destring v66, replace force ignore("Mftcases")rename v66 output_quantity_3label var output_quantity_3 "Quantity of output 3"rename v68 output_unit_3label var output_unit_3 "Unit of output 3"rename v67 output_value_3label var output_value_3 "Value of output 3"rename v69 output_specify_3label var output_specify_3 "Type of output 3"replace morethan3products="1" if morethan3products=="Yes"replace morethan3products="0" if morethan3products=="No" | morethan3products==""destring morethan3products, replace forcelabel values morethan3products yesnorename v71 total_output_valuedestring total_output_value, force replace//what is agggregatevalueofallproducts?destring v90, replace force ignore("Mftcases ")rename v90 input_quantity_1label var input_quantity_1 "Quantity of input 1"rename v92 input_unit_1label var input_unit_1 "Unit of input 1"destring v91, replace force ignore("Mftcases ")rename v91 input_value_1label var input_value_1 "Value of input 1"rename v93 input_specify_1label var input_specify_1 "Type of input 1"destring v94, replace force ignore("Mftcaseslb ")rename v94 input_quantity_2label var input_quantity_2 "Quantity of input 2"rename v96 input_unit_2label var input_unit_2 "Unit of input 2"destring v95, replace force ignore("Mftcaseslb ")rename v95 input_value_2label var input_value_2 "Value of input 2"rename v97 input_specify_2label var input_specify_2 "Type of input 2"destring v98, replace force ignore("gsl ")rename v98 input_quantity_3label var input_quantity_3 "Quantity of input 3"rename v100 input_unit_3label var input_unit_3 "Unit of input 3"rename v99 input_value_3label var input_value_3 "Value of input 3"rename v101 input_specify_3label var input_specify_3 "Type of input 3"replace morethan3materials = "1" if morethan3materials=="Yes"replace morethan3materials = "0" if morethan3materials=="No" | morethan3materials==""rename morethan3materials morethan3inputs//we're not really going to use these variables now so we won't do anymore cleaning of the types, etc.//there is nothing going on in the capacity variablesdestring horsedrawnnumber, force replacerename horsedrawnnumber delivery_horsedrawn_numberlabel var delivery_horsedrawn_number "Number of hourse drawn delivery vehicles"rename capacity delivery_horsedrawn_capacitylabel var delivery_horsedrawn_capacity "Capacity of hourse drawn delivery vehicles"replace gasolinenumber = "0" if gasolinenumber=="None"replace gasolinenumber = ".75" if gasolinenumber=="3/4"destring gasolinenumber, force replacerename gasolinenumber delivery_gasoline_numberrename v107 delivery_gasoline_capacitylabel var delivery_gasoline_number "Number of gasoline delivery vehicles"label var delivery_gasoline_capacity "Capacity of gasoline delivery vehicles"//these variables look basically blank (?)replace electricnumber = "0" if electricnumber=="None"replace electricnumber = ".75" if electricnumber=="3/4"destring electricnumber, force replacerename electricnumber delivery_electric_numberrename v109 delivery_electric_capacitylabel var delivery_electric_number "Number of electric delivery vehicles"label var delivery_electric_capacity "Capacity of electric delivery vehicles"rename steamenginenumber steamengine_numberrename steamenginehorsepower steamengine_horsepower rename steamturbinesnumber steamturbines_numberrename steamturbineshorsepower steamturbines_horsepowerrename internalcombustionenginesnumber internalcombustion_number rename internalcombustionengineshorsepo internalcombustion_horsepower rename waterwheelsnumber waterwheels_number rename waterwheelshorsepower waterwheels_horsepower rename electricmotorsnumber motor_purchased_number rename electricmotorsdrivenbypurchasedc motor_purchased_horsepowerrename electricmotorsdrivenbycurrentgen motor_generated_number rename v85 motor_generated_horsepowerrename generatedinplant electricity_generated_plantrename purchased electricity_purchasedrename cost cost_electricitylabel var cost_electricity "Total cost of electricity"drop machine1-grossofcrownslabel var began "Begin Date"label var end "End Date"replace output_unit_1 = "Barrels (200 lbs.)" if output_unit_1=="Barrels"replace output_unit_2 = "Barrels (200 lbs.)" if output_unit_2=="Barrels"replace output_unit_3 = "Barrels (200 lbs.)" if output_unit_3=="Barrels"replace output_unit_1 = "Tons" if output_unit_1=="Tons  2,000 lbs."replace output_unit_2 = "Tons" if output_unit_2=="Tons  2,000 lbs."replace output_unit_3 = "Tons" if output_unit_3=="Tons  2,000 lbs."replace output_unit_1 = "Tons" if output_unit_1=="Tons of 2,000 lbs."replace output_unit_2 = "Tons" if output_unit_2=="Tons of 2,000 lbs."replace output_unit_3 = "Tons" if output_unit_3=="Tons of 2,000 lbs."replace output_unit_1 = "Tons" if output_unit_1=="tons"replace output_unit_2 = "Tons" if output_unit_2=="tons"replace output_unit_3 = "Tons" if output_unit_3=="tons"replace output_unit_1 = "Gallons" if output_unit_1=="Gals."replace output_unit_2 = "Gallons" if output_unit_2=="Gals."replace output_unit_3 = "Gallons" if output_unit_3=="Gals."replace input_unit_1 = "Tons" if input_unit_1=="Short Tons"replace input_unit_2 = "Tons" if input_unit_2=="Short Tons"replace input_unit_3 = "Tons" if input_unit_3=="Short Tons"replace output_specify_1 = "Can Ice (Raw Water)" if output_specify_1=="Raw Water"replace output_specify_2 = "Can Ice (Raw Water)" if output_specify_2=="Raw Water"replace output_specify_3 = "Can Ice (Raw Water)" if output_specify_3=="Raw Water"replace output_unit_1 = "Tons" if regexm(output_unit_1, "Tons")replace output_unit_2 = "Tons" if regexm(output_unit_2, "Tons")replace output_unit_3 = "Tons" if regexm(output_unit_3, "Tons")replace input_unit_1 = "Number" if regexm(input_unit_1, "Number")replace input_unit_2 = "Number" if regexm(input_unit_2, "Number")replace input_unit_3 = "Number" if regexm(input_unit_3, "Number")replace input_unit_1 = "Pounds" if regexm(input_unit_1, "Pounds")replace input_unit_2 = "Pounds" if regexm(input_unit_2, "Pounds")replace input_unit_3 = "Pounds" if regexm(input_unit_3, "Pounds")replace input_unit_1 = "Pounds" if regexm(input_unit_1, "lbs.")replace input_unit_2 = "Pounds" if regexm(input_unit_2, "lbs.")replace input_unit_3 = "Pounds" if regexm(input_unit_3, "lbs.")replace county = "Yalobusha" if regexm(county, "Yalobusha")  replace county = "Lowndes" if regexm(county, "Lowndes")  replace county = "Lee" if regexm(county, "Lee")  replace input_specify_1 = "Carbonic Gas" if regexm(input_unit_1, "Carbonic Gas")replace input_specify_2 = "Carbonic Gas" if regexm(input_unit_2, "Carbonic Gas")replace input_specify_3 = "Carbonic Gas" if regexm(input_unit_3, "Carbonic Gas")replace input_specify_1 = "Cream" if regexm(input_unit_1, "Cream")replace input_specify_2 = "Cream" if regexm(input_unit_2, "Cream")replace input_specify_3 = "Cream" if regexm(input_unit_3, "Cream")replace input_specify_1 = "Milk" if regexm(input_unit_1, "Milk")replace input_specify_2 = "Milk" if regexm(input_unit_2, "Milk")replace input_specify_3 = "Milk" if regexm(input_unit_3, "Milk")destring steamengine_horsepower, replace force ignore("Est H.P")destring motor_purchased_number, replace force ignore("Est H.P")destring motor_purchased_horsepower, replace force ignore("Est H.Pp")destring motor_generated_number, replace force ignore("Est H.Pp")destring motor_generated_horsepower, replace force ignore("Est H.Pp")destring delivery_gasoline_capacity, replace forcedestring electricity_generated_plant, replace force ignore("Est H.Pp")rename electricity_generated_plant electricity_generateddestring electricity_purchased, replace force ignore("Est H.Pp")label var electricity_generated "Generated electricity"label var electricity_purchased "Purchased electricity"replace total_output_value = aggregatevalueofallproduct if total_output_value==.rename totalvalueofproductsmanufactured total_output_value_mantostring total_output_value, force replacereplace total_output_value = total_output_value_man if total_output_value==""destring total_output_value_man, replace forcereplace isthisanewplantwhichstartedopera = "1" if isthisanewplantwhichstartedopera=="Yes"replace isthisanewplantwhichstartedopera = "0" if isthisanewplantwhichstartedopera=="No"rename costofpurchasedcurrent cost_purchased_currentreplace total_cost_materials = costofallmaterials if industrycode~=311drop costofallmaterials change_*gen censusyear=1929drop imagenumber usedorpurchased notes e g h i v89 cost_materials_2 cost_materials_3 cost_materials_4 aggregatevalueofallproductrename totalcost total_cost_inputslabel var total_cost_inputs "Total of value for inputs"rename a sales_wholesale_not_ownedlabel var sales_wholesale_not_owned "Total sales to wholesalers not owned by firm"rename b sales_wholesale_ownedlabel var sales_wholesale_owned "Total sales to wholesalers owned by firm"rename d sales_retail_ownedlabel var sales_retail_owned "Total sales to retailers owned by firm"rename c sales_retail_not_ownedlabel var sales_retail_not_owned "Total sales to retailers not owned by firm"rename f sales_homelabel var sales_home "Total sales to home consumers"rename v130 total_saleslabel var total_sales "Total sales"//still thinks something is screwy with lumber output data//should i code all of the different products?//probably a few more units to fix if really want totostring industrycode, replace force//this is merging in matched firmidssort industrycode nameofplant county citytownorvillage  gen firmid_1929 = _nsort firmid_1929merge firmid_1929 using  "/Users/nicolaslehmannziebarth/Dropbox/Depression Census/Datasets/Mississippi/matching_1929.dta", uniqusing//this should be more or less redundantkeep if _merge==3drop _merge firmid_1929rename numberofshiftsperday shiftsperdaytostring *, replace forcesave MS_1929, replacelog close