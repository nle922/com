//Update county and city variables for CA
//Acknowledgments: Based on code generously shared by Sarah Quincy.

replace ag002 = subinstr(ag002, "Near ", "",1)
replace ag002 = subinstr(ag002, "Village of ", "",1)
replace ag002 = proper(ag002)
replace ag003 = "Los Angeles" if ag001=="California" &  ag003=="0" //based on city
replace ag003 = "Alameda" if ag001=="California" &  ag003=="1115-13Th Ave" | ag003=="9109-E. 14 St"
replace ag003 = "Los Angeles" if ag001=="California" &  ag003=="Belvedere"
replace ag002 = "Los Angeles" if ag001=="California" &  ag003=="Belvedere"
replace ag002 = "Berkeley" if ag001=="California" &  ag003=="Berkeley"
replace ag003 = "Alameda" if ag001=="California" &  ag003=="Berkeley"
replace ag002 = "Burbank" if ag001=="California" &  ag003=="Burbank"
replace ag003 = "Los Angeles" if ag001=="California" &  ag003=="Burbank"
replace ag002 = "Modesto" if ag001=="California" &  ag003=="California"
replace ag003 = "Stanislaus" if ag001=="California" &  ag003=="California"
replace ag002 = "El Segundo" if ag001=="California" &  ag003=="El Segundo"
replace ag003 = "Los Angeles" if ag003 == "El Segundo"
replace ag002 = "Glendale" if ag001=="California" &  ag003=="Glendale"
replace ag003 = "Los Angeles" if ag001=="California" &  ag003=="Glendale"
replace ag002 = "Inglewood" if ag001=="California" &  ag003=="Inglewood"
replace ag003 = "Los Angeles" if ag001=="California" &  ag003=="Inglewood"
replace ag002 = "Long Beach" if ag001=="California" &  ag003=="Long Beach"
replace ag003 = "Los Angeles" if ag001=="California" &  ag003=="Long Beach"
replace ag003 = "Los Angeles" if ag001=="California" &  ag003=="Los Algeles"
replace ag003 = "Marin" if ag001=="California" &  ag003=="Merin"
replace ag002 = "Midway City" if ag001=="California" &  ag003=="Midway City"
replace ag003 = "Orange" if ag001=="California" &  ag003=="Midway City"
replace ag003 = "Napa" if ag001=="California" &  ag003=="S"
replace ag003 = "Santa Cruz" if ag002=="Watsonville"
replace ag002 = "San Pedro" if ag001=="California" &  ag003=="San Pedro"
replace ag003 = "Los Angeles" if ag001=="California" &  ag003=="San Pedro"
replace ag002 = "Santa Monica" if ag001=="California" &  ag003=="Santa Monica"
replace ag003 = "Los Angeles" if ag001=="California" &  ag003=="Santa Monica"
replace ag002 = "Seal Beach" if ag001=="California" &  ag003=="Seal Beach"
replace ag003 = "Orange" if ag001=="California" &  ag003=="Seal Beach"
replace ag002 = "South San Francisco" if ag001=="California" &  ag003=="South San Fransisco"
replace ag003 = "San Mateo" if ag001=="California" &  ag003=="South San Fransisco"
replace ag002 = "Van Nuys" if ag001=="California" &  ag003=="Van Nuys"
replace ag003 = "Los Angeles" if ag001=="California" &  ag003=="Van Nuys"
replace ag002 = "Venice" if ag001=="California" &  ag003=="Venice"
replace ag003 = "Los Angeles" if ag001=="California" &  ag003=="Venice"
replace ag002 = "Merced" if ag002=="17th N. Sts. Merced" & ag001=="California"
replace ag002 = "Santa Barbara" if ag002=="332 E. Haley St., Santa Barbara" & ag001=="California"
replace ag002 = subinstr(ag002, ", California","",.) if ag001=="California"
replace ag002 = subinstr(ag002, ", Calif.","",.) if ag001=="California"
replace ag002 = subinstr(ag002, ", Calif","",.) if ag001=="California"
replace ag002 = "Alameda" if ag002=="Alameda. City" & ag001=="California"
replace ag002 = "Angels Camp" if ag002 == "Angels Camp." & ag001=="California"
replace ag002 = "Anaheim" if (ag002=="Anheim" | ag002=="Annaheim") & ag001=="California"
replace ag002 = "Arcadia" if ag002=="Arcadia City" & ag001=="California"
replace ag002 = "Bakersfield" if ag002=="Bakersfield." & ag001=="California"
replace ag002 = "Barstow" if ag002=="Barstow (San Bernardino)" & ag001=="California"
replace ag002 = "Bayshore" if ag002=="Bay Shore" & ag001=="California"
replace ag002 = "Bay Point" if ag002=="Bay point" & ag001=="California"
replace ag002 = "Berkeley" if (ag002=="Berkely" | ag002=="Berkley") & ag001=="California"
replace ag002 = "Casmalia" if ag002=="Casmalis" & ag001=="California"
replace ag002 = "El Cajon" if ag002=="City El Cajon" & ag001=="California"
replace ag002 = "Los Angeles" if (ag002=="City Los Angeles" | ag002=="Los Angeles Calif." | ag002=="Los Angeles," | ag002=="Los Angleles") & ag001=="California"
replace ag002 = "San Pedro" if ag002 == "City San Pedro" & ag001=="California"
replace ag002 = "San Francisco" if ag002=="City, San Francisco" & ag001=="California"
replace ag002 = "East Pasadena" if ag002=="E. Pasadena" & ag001=="California"
replace ag002 = "El Monte" if (ag002=="EL Monte" | ag002=="El Monta" | ag002=="El. Monte") & ag001=="California"
replace ag002 = "Escondido" if (ag002=="Escandido" | ag002=="Esdondido") & ag001=="California"
replace ag002 = "Kingsburg" if ag002=="Fresno Kingsburg" & ag001=="California"
replace ag002 = "Fresno" if (ag002=="Fresno." | ag002=="Fresno,") & ag001=="California"
replace ag002 = "Glendale" if ag002=="Glendale Cal" & ag001=="California"
replace ag002 = "Hanford" if (ag002 == "Handford" | ag002=="Hauford") & ag001=="California"
replace ag002 = "Hayward" if ag002 == "Havward" & ag001=="California"
replace ag002 = "Saint Helena" if (ag002 == "Helena" | ag002=="St Helena" | ag002=="St. Helena") & ag001=="California"
replace ag002 = "-  " if (ag002 =="Hollywood (Los Angeles)" | ag002=="Hollywood L.A.") & ag001=="California"
replace ag002 = "Hynes" if ag002 == "Hynes ?" & ag001=="California"
replace ag002 = "Long Beach" if (ag002 == "Long Beach ?" | ag002=="Long Beach City") & ag001=="California"
replace ag002 = "Wilmington" if ag002 =="Los Angeles   Wilmington" & ag001=="California"
replace ag002 = "Venice" if ag002=="Los Angeles Venice" & ag001=="California"
replace ag002 = "Vernon" if (ag002=="Los Angeles, (Vernon)" | ag002=="Vernon city" | ag002=="Vernon (Los Angeles)" | ag002=="Vernon-Los Angeles") & ag001=="California"
replace ag002 = "Maricopa" if (ag002=="Maricope" | ag002=="Village of Maricopa") & ag001=="California"
replace ag002 = "Merced" if ag002=="Merced City" & ag001=="California"
replace ag002 = "Modesto" if (ag002 == "Modesto Dal" | ag002=="Modesto Plant") & ag001=="California"
replace ag002 = "Santa Monica" if ag002=="Monica" & ag001=="California"
replace ag002 = "Monterey" if ag002=="Montercy" & ag001=="California"
replace ag002 = "Mount Shasta" if (ag002=="Mt. Shasta" | ag002=="Mt Shasta") & ag001=="California"
replace ag002 = "North Sacramento" if (ag002=="N. Sacramento" | ag002=="No Sacramento") & ag001=="California"
replace ag002 = "Newport Beach" if ag002=="New Port Beach" & ag001=="California"
replace ag002 = "North Hollywood" if (ag002=="No. Hollywood" | ag002 =="North Hollywood (Lankershim)") & ag001=="California"
replace ag002 = "Otay" if ag002 =="Otay, Otay Townsley" & ag001=="California"
replace ag002 = "Oakland" if ag002 == "Okland" & ag001=="California"
replace ag002 = "Oxnard" if (ag002 =="Oxnarad" | ag002=="Oxnard. City") & ag001=="California"
replace ag002 = "Pittsburg" if (ag002=="PIttsburgh" | ag002=="Pittsburgh" | ag002=="West Pittsburg Calif.") & ag001=="California"
replace ag002 = "Palmdale" if ag002=="Palmdele" & ag001=="California"
replace ag002 = "Pico" if ag002=="Pico near Whittier" & ag001=="California"
replace ag002 = "Porterville" if ag002=="Porterville Calif." & ag001=="California"
replace ag002 = "Riverside" if ag002=="Riverside City" & ag001=="California"
replace ag002 = "Ramona" if ag002=="Romona" & ag001=="California"
replace ag002 = "Salinas" if ag002=="Salinas City" & ag001=="California"
replace ag002 = "San Diego" if (ag002=="San  Diego"  | ag002=="San Diego,") & ag001=="California"
replace ag002 = "San Bernardino" if ag002=="San Bernadino" & ag001=="California"
replace ag002 = "Ventura" if (ag002=="San Buenaventura" | ag002=="Vantura") & ag001=="California"
replace ag002 = "San Francisco" if (ag002=="San Francisco Cal." | ag002=="San Fransisco")
replace ag002 = "San Jacinto" if ag002=="San Jacinto Calif" & ag001=="California"
replace ag002 = "San Jose" if ag002=="San Jose," & ag001=="California"
replace ag002 = "San Juan Bautista" if ag002=="San Juan Bautists" & ag001=="California"
replace ag002 = "San Leandro" if regexm(ag002, "San Leandroat") & ag001=="California"
replace ag002 = "San Rafael" if ag002=="San Rafeal" & ag001=="California"
replace ag002 = "San Fernando" if ag002=="San fernando" & ag001=="California"
replace ag002 = "Santa Clara" if ag002=="Santa Clara." & ag001=="California"
replace ag002 = "Santa Cruz" if ag002=="Santa Curz" & ag001=="California"
replace ag002 = "Santa Paula" if ag002=="Santa Pauls" & ag001=="California"
replace ag002 = "Santa Rosa" if ag002=="Santa Rose" & ag001=="California"
replace ag002 = "Signal Hill" if ag002=="Signal Hill-Long Beach" & ag001=="California"
replace ag002 = "South San Francisco" if (ag002=="So San Francisco" | ag002=="So. San Francisco" | ag002=="South San Francisco ?") & ag001=="California"
replace ag002 = "South Gate" if ag002=="Southgate" & ag001=="California"
replace ag002 = "South Pasadena" if ag002=="So. Pasadena" & ag001=="California"
replace ag002 = "Monrovia" if ag002=="South Monrovia" & ag001=="California"
replace ag002 = "Stockton" if ag002=="Stocton" & ag001=="California"
replace ag002 = "Sunnyvale" if ag002=="Sunnyvele" & ag001=="California"
replace ag002 = "Tustin" if ag002=="Tostin" & ag001=="California"
replace ag002 = "Gonzales" if ag002=="Town Gonzales" & ag001=="California"
replace ag002 = "Van Nuys" if ag002=="Van Nuy" & ag001=="California"
replace ag002 = "Indio" if ag002=="Indis" & ag001=="California"
replace ag002 = "West Los Angeles" if ag002=="W. Los Angeles" & ag001=="California"
replace ag002 = "Santa Maria" if ag002=="Santa Barbara" & regexm(a001, "Coca Cola") & ag001=="California"
replace ag002 = "Emeryville" if ag002=="Ermenonville" & ag001=="California" //same company name and parent company
replace ag001="Colorado" if ag001=="California" &  (ag003=="Larimer" | ag003=="Grundy" | ag003=="Adams") //Actually CO Counties
tempfile curr_data
save `curr_data'

*bring in cleaned locations from Excel
import excel "./SES1459263 Team Folder/V2/Geography Updates/clean_census_mfg_locs_CA.xlsx", firstrow clear 
rename AG003 ag003
rename AG002 ag002
merge 1:m ag002 ag003 using `curr_data'
drop if _merge == 1 //This doesn't merge.
replace ag002="Los Angeles" if loctype=="put into LA"
replace ag002=new_AG002 if _merge==3 & new_AG002~=""
replace ag003=new_AG003 if _merge==3 & new_AG003~=""

//Cleanup
drop new_AG003 new_AG002 _merge
